name: LaTeX CV Build and Publish

on:
  push:
    branches:
      - master
      - devops

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Setup TeX Live
        uses: xu-cheng/latex-action@v2
        with:
          root_file: |
            english.tex
            turkish.tex
          latexmk_use_xelatex: true

      - name: Move artifacts
        run: |
          mkdir -p artifacts
          mv build/english.pdf artifacts/HarunSokullu_en.pdf
          mv build/turkish.pdf artifacts/HarunSokullu_tr.pdf

      - name: Upload artifacts
        uses: actions/upload-artifact@v2
        with:
          name: artifacts
          path: artifacts

  publish:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Download artifacts
        uses: actions/download-artifact@v2
        with:
          name: artifacts
          path: artifacts

      - name: Setup Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.17

      - name: Publish release on GitHub
        run: |
          go get github.com/tcnksm/ghr
          VERSION=1.0.0
          GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
          REPO_OWNER=${{ github.repository_owner }}
          REPO_NAME=${{ github.event.repository.name }}
          COMMIT_SHA=${{ github.sha }}
          ghr -t "${GITHUB_TOKEN}" -u "${REPO_OWNER}" -r "${REPO_NAME}" -c "${COMMIT_SHA}" -delete "${VERSION}" artifacts
